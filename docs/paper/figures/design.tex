\documentclass[crop,tikz]{standalone}

\input{figures/packages.tex}

\begin{document}
    \begin{tikzpicture}[scale=0.9, every node/.style={transform shape}]
    
        % Worker Kernel
        
        \draw[every rectangle node/.style={draw}]
            node (InputLoop) at (0,0) {Input Loop}
            node (RealizeMoves) at (2.5,-1) {Finalize Move}
            node (ModAndScore) at (0,-2) {Execute Move}
            node (OutputLoop) at (0,-3.5) {Output Loop};
    
        \coordinate (CurrentTreeHub) at (0, -1);
        \filldraw (CurrentTreeHub) circle (2pt) node[left] {current tree \& score};
        \draw[-{Stealth[length=.2cm]}] (InputLoop) -- (CurrentTreeHub) -- (ModAndScore);
        \draw[-{Stealth[length=.2cm]}] (CurrentTreeHub) -- (0, -1) -- (RealizeMoves); 
    
        \draw[-{Stealth[length=.2cm]}] (RealizeMoves) |- node[below] {random move} (ModAndScore);
    
        \draw[-{Stealth[length=.2cm]}] (ModAndScore) -- node[right] {(new) current tree \& score} (OutputLoop);
    
        \draw[dashed] (-3,-0.5) -- (4.5,-0.5);
        \draw[dashed] (-3,-1.5) -- (4.5,-1.5);
        \draw[dashed] (-3,-3) -- (4.5,-3);
    
        \draw node at (2.5, 0) {\textbf{Worker Kernel}};
        \draw[very thick] (-3,0.5) -- (4.5,0.5) -- (4.5,-4) -- (-3,-4) -- (-3,0.5);
    
        % IO Kernel
    
        \draw[every rectangle node/.style={draw}]
            node (IOKernel) at (0, -5.5) {\textbf{IO Kernel}};
    
        \draw[-{Stealth[length=.2cm]}, draw=emph2, thick] (IOKernel) -- (-3.5, -5.5) -- (-3.5, 1) -- node[above] {current tree \& score (serial packets)} (0, 1) -- (InputLoop);
        \draw[-{Stealth[length=.2cm]}, draw=emph2, thick] (OutputLoop) -- node[right, text width=3.5cm] {(new) current tree \& score (serial packets)} (IOKernel);
    
        % Global memory
    
        \draw[every rectangle node/.style={draw}]
            node (GlobalMemory) at (-0.5, -7.5) {\textbf{Global Memory}};
    
        \draw[-{Stealth[length=.2cm]}, draw=emph, thick] (GlobalMemory) -- (-0.5, -6.5) -| node[right,text width=3cm] {initial tree \& score (serial packets)} (IOKernel);
        \draw[-{Stealth[length=.2cm]}, draw=emph, thick] (GlobalMemory) -- node[below] {random move template} (5, -7.5) -- (5, -1) -- (RealizeMoves);
    \end{tikzpicture}
\end{document}